<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Hours Tracker</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <style>
    :root{
      --bg:#f6f7fb;--card:#ffffff;--text:#0b1020;--muted:#5b6270;--accent:#6b46c1;
    }
    [data-theme='dark']{--bg:#0b0d12;--card:#0f1720;--text:#e6eef8;--muted:#9aa4b2;--accent:#8b5cf6}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:var(--text);padding:18px}
    .app{max-width:980px;margin:0 auto;display:grid;grid-template-columns:1fr;gap:14px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:20px}
    .top-row{display:flex;flex-wrap:wrap;gap:12px}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(11,16,32,0.06)}
    .small{font-size:13px;color:var(--muted)}
    .big{font-size:28px;font-weight:600}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:white;border:0;padding:8px 10px;border-radius:10px;cursor:pointer}
    input,select,textarea{padding:8px;border-radius:8px;border:1px solid #dfe6f2;background:transparent;color:var(--text)}
    .muted{color:var(--muted)}
    .flex{display:flex;gap:8px;align-items:center}
    .right{margin-left:auto}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .day{padding:8px;border-radius:8px;text-align:center}
    .day .date{font-weight:600}
    .log-list{max-height:220px;overflow:auto}
    .log-item{display:flex;justify-content:space-between;padding:8px;border-radius:8px;border:1px dashed rgba(11,16,32,0.06);margin-bottom:8px}
    .chart-wrap{height:180px}
    footer{font-size:13px;color:var(--muted);text-align:center;padding:8px}
    @media(max-width:760px){.grid{grid-template-columns:1fr}.calendar{grid-template-columns:repeat(7,auto);overflow:auto;padding-bottom:6px}}
  </style>
</head>
<body>
  <div class="app" id="app" data-theme>
    <header class="card">
      <div style="display:flex;gap:12px;align-items:center">
        <div>
          <h1>Live Hours Tracker</h1>
          <div class="small muted" id="todayDate">--</div>
        </div>
<div class="timer-box" style="margin-top:12px;padding:12px;border:1px dashed #ccc;border-radius:10px;text-align:center">
  <div class="small muted">OR use Live Timer</div>
  <div id="timerDisplay" style="font-size:26px;font-weight:bold;margin:8px 0">00:00:00</div>
  <button id="startBtn" style="background:#28a745;color:white">Start Timer</button>
  <button id="stopBtn" style="background:#dc3545;color:white;display:none">Stop & Save</button>
</div>

      </div>
      <div class="controls">
        <label class="small muted">Dark</label>
        <input type="checkbox" id="toggleDark">
      </div>
    </header>

    <section class="top-row">
      <div class="card" style="flex:1">
        <div class="small muted">Today's awake total (fixed)</div>
        <div class="big" id="awakeTotal">-- hrs</div>
        <div class="small muted">Awake time remaining (live)</div>
        <div class="big" id="awakeRemaining">--:--:--</div>
      </div>

      <div class="card" style="width:320px">
        <div class="small muted">Target hours (daily)</div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
          <input type="number" id="targetHours" min="0" value="4" style="width:84px">
          <button id="saveTarget">Save</button>
          <div class="right small muted">Remaining: <span id="targetRemaining">--:--</span></div>
        </div>
<div class="timer-box" style="margin-top:12px;padding:12px;border:1px dashed #ccc;border-radius:10px;text-align:center">
  <div class="small muted">OR use Live Timer</div>
  <div id="timerDisplay" style="font-size:26px;font-weight:bold;margin:8px 0">00:00:00</div>
  <button id="startBtn" style="background:#28a745;color:white">Start Timer</button>
  <button id="stopBtn" style="background:#dc3545;color:white;display:none">Stop & Save</button>
</div>

        <div style="margin-top:8px" class="small muted">Streak: <strong id="streak">0</strong> days</div>
      </div>
    </section>

    <section class="grid">
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div>
            <div class="small muted">Add Session (auto-saved)</div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input type="time" id="sessionStart" value="08:00" />
              <input type="time" id="sessionEnd" value="09:00" />
              <button id="addSession">Add</button>
            </div>
          </div>
          <div style="text-align:right">
            <div class="small muted">Total logged today</div>
            <div class="big" id="loggedToday">0h 0m</div>
          </div>
        </div>
<div class="timer-box" style="margin-top:12px;padding:12px;border:1px dashed #ccc;border-radius:10px;text-align:center">
  <div class="small muted">OR use Live Timer</div>
  <div id="timerDisplay" style="font-size:26px;font-weight:bold;margin:8px 0">00:00:00</div>
  <button id="startBtn" style="background:#28a745;color:white">Start Timer</button>
  <button id="stopBtn" style="background:#dc3545;color:white;display:none">Stop & Save</button>
</div>


        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(11,16,32,0.04)" />

        <div class="small muted">Daily Log</div>
        <div class="log-list" id="logList"></div>
      </div>

      <div class="card">
        <div class="small muted">Weekly Calendar</div>
        <div class="calendar" id="calendar"></div>
        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(11,16,32,0.04)" />
        <div class="small muted">Weekly Line Chart</div>
        <div class="chart-wrap"><canvas id="weekChart"></canvas></div>
      </div>
    </section>

    <footer class="card small muted">Auto-saves locally in your browser. Mobile-friendly. Export/Import data available in Settings (top-right)</footer>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js">
// ---- TIMER LOGIC ADDITION ----
let sec=0, liveTimer=null;
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const timerDisplay=document.getElementById('timerDisplay');

if(startBtn){
startBtn.onclick=()=>{
  sec=0;
  startBtn.style.display='none';
  stopBtn.style.display='inline-block';
  liveTimer=setInterval(()=>{
    sec++;
    const h=String(Math.floor(sec/3600)).padStart(2,'0');
    const m=String(Math.floor((sec%3600)/60)).padStart(2,'0');
    const s=String(sec%60).padStart(2,'0');
    timerDisplay.textContent=`${h}:${m}:${s}`;
  },1000);
};

stopBtn.onclick=()=>{
  clearInterval(liveTimer);
  stopBtn.style.display='none';
  startBtn.style.display='inline-block';

  const durMin=Math.floor(sec/60);
  const key=todayToKey();
  if(!state.sessions[key]) state.sessions[key]=[];
  state.sessions[key].push({
    id:'t_'+Date.now(),
    start:'Timer',
    end:'Timer',
    durationMinutes:durMin
  });
  saveState();
  renderAll();
  timerDisplay.textContent='00:00:00';
};
}

</script>

  <script>
    // Configuration
    const SLEEP_START = 22; // 22:00
    const SLEEP_END = 6;    // 06:00
    const STORAGE_KEY = 'live_hours_tracker_v1';

    // Simple app state persisted to localStorage
    const defaultState = {
      targetHours: 4,
      sessions: {}, // keyed by yyyy-mm-dd -> [{id,start,end,durationMinutes}]
      timezoneOffsetMinutes: new Date().getTimezoneOffset()
    };

    let state = loadState();

    // Elements
    const todayDateEl = document.getElementById('todayDate');
    const awakeTotalEl = document.getElementById('awakeTotal');
    const awakeRemainingEl = document.getElementById('awakeRemaining');
    const targetHoursInput = document.getElementById('targetHours');
    const saveTargetBtn = document.getElementById('saveTarget');
    const targetRemainingEl = document.getElementById('targetRemaining');
    const loggedTodayEl = document.getElementById('loggedToday');
    const sessionStart = document.getElementById('sessionStart');
    const sessionEnd = document.getElementById('sessionEnd');
    const addSessionBtn = document.getElementById('addSession');
    const logList = document.getElementById('logList');
    const calendarEl = document.getElementById('calendar');
    const streakEl = document.getElementById('streak');
    const toggleDark = document.getElementById('toggleDark');

    // Chart
    let weekChart;

    // Init
    init();

    function init(){
      // load target
      targetHoursInput.value = state.targetHours || defaultState.targetHours;
      targetHoursInput.addEventListener('change', e=>{
        state.targetHours = Number(e.target.value)||0; saveState(); renderAll();
      });
      saveTargetBtn.addEventListener('click', ()=>{ state.targetHours = Number(targetHoursInput.value)||0; saveState(); renderAll(); });

      addSessionBtn.addEventListener('click', addSessionFromInputs);

      toggleDark.addEventListener('change', (e)=>{
        document.getElementById('app').setAttribute('data-theme', e.target.checked ? 'dark' : 'light');
        if(e.target.checked) localStorage.setItem('live_hours_theme','dark'); else localStorage.removeItem('live_hours_theme');
      });
      // theme from storage
      if(localStorage.getItem('live_hours_theme')==='dark'){ toggleDark.checked=true; document.getElementById('app').setAttribute('data-theme','dark'); }

      renderAll();
      startTimers();
      buildChart();
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return JSON.parse(JSON.stringify(defaultState));
        const parsed = JSON.parse(raw);
        return Object.assign(JSON.parse(JSON.stringify(defaultState)), parsed);
      }catch(e){
        console.error('load error',e); return JSON.parse(JSON.stringify(defaultState));
      }
    }
    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function renderAll(){
      const today = new Date();
      todayDateEl.textContent = today.toLocaleDateString(undefined, {weekday:'long', year:'numeric', month:'short', day:'numeric'});
      const awakeTotal = 24 - (24 - (SLEEP_START - SLEEP_END + 24)%24) ; // simpler: sleep length
      const sleepLen = (SLEEP_START - SLEEP_END + 24)%24; // e.g., 16 -> 8
      const awakeLen = 24 - sleepLen;
      awakeTotalEl.textContent = awakeLen + ' hrs';

      // target
      targetRemainingEl.textContent = formatHoursMinutes(calculateTargetRemainingForToday());

      // logged total today
      loggedTodayEl.textContent = formatHoursMinutes(calculateLoggedMinutes(todayToKey())/60);

      renderLogList();
      renderCalendar();
      updateStreak();
      updateChartData();
    }

    function startTimers(){
      updateAwakeRemaining();
      setInterval(()=>{ updateAwakeRemaining(); }, 1000);
    }

    function updateAwakeRemaining(){
      const now = new Date();
      const todayKey = todayToKey();
      const nowHour = now.getHours();
      // If now is in awake window (SLEEP_END .. SLEEP_START)
      let remainingMs = 0;
      const startWake = setToToday(SLEEP_END,0,0);
      const startSleep = setToToday(SLEEP_START,0,0);
      if(now >= startWake && now < startSleep){
        remainingMs = startSleep - now;
      } else if(now < startWake){
        // before wake time, remaining awake today equals full awake window
        remainingMs = startSleep - startWake;
      } else {
        // after sleep start -> 0 remaining for today's awake
        remainingMs = 0;
      }
      awakeRemainingEl.textContent = msToHMS(remainingMs);
      // also update logged/target remaining every second
      targetRemainingEl.textContent = formatHoursMinutes(calculateTargetRemainingForToday());
      loggedTodayEl.textContent = formatHoursMinutes(calculateLoggedMinutes(todayKey)/60);
    }

    function setToToday(hour,minute,second){
      const d = new Date(); d.setHours(hour,minute,second,0); return d;
    }

    function msToHMS(ms){
      let s = Math.max(0,Math.floor(ms/1000));
      const h = Math.floor(s/3600); s%=3600; const m=Math.floor(s/60); const sec=s%60;
      return pad(h)+":"+pad(m)+":"+pad(sec);
    }
    function pad(n){return n.toString().padStart(2,'0')}

    function todayToKey(offsetDays=0){
      const d = new Date(); d.setDate(d.getDate()+offsetDays);
      return d.toISOString().slice(0,10);
    }

    function addSessionFromInputs(){
      const start = sessionStart.value; const end = sessionEnd.value;
      if(!start || !end){ alert('Provide start and end'); return; }
      const dur = computeDurationFromTimes(start,end);
      if(dur<=0){ alert('End must be after start'); return; }
      const id = 's_'+Date.now();
      const key = todayToKey();
      if(!state.sessions[key]) state.sessions[key]=[];
      state.sessions[key].push({id,start,end,durationMinutes:dur});
      saveState(); renderAll();
    }

    function computeDurationFromTimes(startHHMM,endHHMM){
      const [sh,sm]=startHHMM.split(':').map(Number); const [eh,em]=endHHMM.split(':').map(Number);
      const s = sh*60+sm; const e = eh*60+em; let diff = e - s;
      if(diff<0) diff += 24*60; return diff;
    }

    function renderLogList(){
      logList.innerHTML='';
      const key = todayToKey();
      const items = state.sessions[key]||[];
      if(items.length===0){ logList.innerHTML='<div class="small muted">No log for today</div>'; return; }
      items.slice().reverse().forEach(it=>{
        const div = document.createElement('div'); div.className='log-item';
        const left = document.createElement('div'); left.innerHTML = `<div><strong>${it.start} â†’ ${it.end}</strong></div><div class='small muted'>${it.durationMinutes} min</div>`;
        const right = document.createElement('div');
        const del = document.createElement('button'); del.textContent='Delete'; del.style.background='transparent'; del.style.border='1px solid rgba(11,16,32,0.06)'; del.onclick=()=>{ deleteSession(todayToKey(), it.id); };
        right.appendChild(del);
        div.appendChild(left); div.appendChild(right);
        logList.appendChild(div);
      });
    }

    function deleteSession(key,id){
      if(!state.sessions[key]) return; state.sessions[key]=state.sessions[key].filter(s=>s.id!==id); saveState(); renderAll();
    }

    function calculateLoggedMinutes(key){
      const list = state.sessions[key]||[]; return list.reduce((s,i)=>s + (i.durationMinutes||0),0);
    }

    function calculateTargetRemainingForToday(){
      const target = Number(state.targetHours||0);
      const loggedMins = calculateLoggedMinutes(todayToKey());
      const remainingHours = Math.max(0, target - (loggedMins/60));
      return Math.round(remainingHours*100)/100; // fraction hours
    }

    // Calendar & chart helpers
    function renderCalendar(){
      calendarEl.innerHTML='';
      const start = getStartOfWeek(new Date()); // monday start
      for(let i=0;i<7;i++){
        const d = new Date(start); d.setDate(start.getDate()+i);
        const key = d.toISOString().slice(0,10);
        const minutes = calculateLoggedMinutes(key);
        const div = document.createElement('div'); div.className='day card';
        div.innerHTML = `<div class='date'>${d.toLocaleDateString(undefined,{weekday:'short'})}</div><div class='small muted'>${d.toLocaleDateString(undefined,{month:'short',day:'numeric'})}</div><div style='margin-top:8px;font-weight:600'>${formatHoursMinutes(minutes/60)}</div>`;
        calendarEl.appendChild(div);
      }
    }

    function getStartOfWeek(d){
      const day = d.getDay(); // 0 Sun - 6 Sat
      const diff = (day === 0 ? -6 : 1 - day); // Monday as first day
      const start = new Date(d); start.setDate(d.getDate()+diff); start.setHours(0,0,0,0); return start;
    }

    function updateStreak(){
      // streak = consecutive days up to today where logged minutes >= 60
      let streak=0;
      for(let i=0;i<365;i++){
        const key = todayToKey(-i);
        const mins = calculateLoggedMinutes(key);
        if(mins >= 60) streak++; else break;
      }
      streakEl.textContent = streak;
    }

    // Chart
    function buildChart(){
      const ctx = document.getElementById('weekChart').getContext('2d');
      weekChart = new Chart(ctx,{
        type:'line',
        data:{ labels:[], datasets:[{label:'Hours', data:[], fill:false, tension:0.3}] },
        options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
      });
      updateChartData();
    }

    function updateChartData(){
      const start = getStartOfWeek(new Date());
      const labels = []; const data=[];
      for(let i=0;i<7;i++){
        const d = new Date(start); d.setDate(start.getDate()+i);
        labels.push(d.toLocaleDateString(undefined,{weekday:'short'}));
        const mins = calculateLoggedMinutes(d.toISOString().slice(0,10));
        data.push(Math.round((mins/60)*100)/100);
      }
      if(weekChart){ weekChart.data.labels = labels; weekChart.data.datasets[0].data = data; weekChart.update(); }
    }

    function formatHoursMinutes(h){
      // input h can be fractional hours
      const totalMinutes = Math.round(h*60);
      const hh = Math.floor(totalMinutes/60); const mm = totalMinutes%60; return hh + 'h ' + mm + 'm';
    }

    function pad2(n){ return n.toString().padStart(2,'0'); }

    // small utility: export/import (not shown in UI for brevity but accessible via console)
    window._exportData = ()=> JSON.stringify(state);
    window._importData = (json)=>{ try{ state = JSON.parse(json); saveState(); renderAll(); alert('Imported'); }catch(e){alert('error') } };

  
// ---- TIMER LOGIC ADDITION ----
let sec=0, liveTimer=null;
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const timerDisplay=document.getElementById('timerDisplay');

if(startBtn){
startBtn.onclick=()=>{
  sec=0;
  startBtn.style.display='none';
  stopBtn.style.display='inline-block';
  liveTimer=setInterval(()=>{
    sec++;
    const h=String(Math.floor(sec/3600)).padStart(2,'0');
    const m=String(Math.floor((sec%3600)/60)).padStart(2,'0');
    const s=String(sec%60).padStart(2,'0');
    timerDisplay.textContent=`${h}:${m}:${s}`;
  },1000);
};

stopBtn.onclick=()=>{
  clearInterval(liveTimer);
  stopBtn.style.display='none';
  startBtn.style.display='inline-block';

  const durMin=Math.floor(sec/60);
  const key=todayToKey();
  if(!state.sessions[key]) state.sessions[key]=[];
  state.sessions[key].push({
    id:'t_'+Date.now(),
    start:'Timer',
    end:'Timer',
    durationMinutes:durMin
  });
  saveState();
  renderAll();
  timerDisplay.textContent='00:00:00';
};
}

</script>
</body>
</html>
